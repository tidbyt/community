# Enphase Solar

Tidbyt App to display energy generated by Solar Panels via Enlighten API v4.

# Usage

In order to start App correctly, it is required to provide api key, client id, client secrent, access token and refresh token. Please follow Enphase [Quick Start](https://developer-v4.enphase.com/docs/quickstart.html) about how to get those information.

Once you have your application set up, use following python script to get your access token and refresh token which will be needed when set up the app.

```
from base64 import b64encode
import requests


ENDPOINT = 'https://api.enphaseenergy.com'
REDIRECT_URI = 'https://api.enphaseenergy.com/oauth/redirect_uri'
TOKEN_URL = 'https://api.enphaseenergy.com/oauth/token'

# Manually generate a code
# https://api.enphaseenergy.com/oauth/authorize?response_type=code&
# client_id=<YOUR_CLIENT_ID>&redirect_uri=https://api.enphaseenergy.com/oauth/redirect_uri
CODE = 'CODE_YOU_GET'
CLIENT_ID = 'YOUR_CLIENT_ID'
CLIENT_SECRET = 'YOUR_CLIENT_SECRET'

def generate_basic_headers() -> dict:
    """Generate basic headers for POST or GET requests"""
    encoded_client_secrets = b64encode(f'{CLIENT_ID}:{CLIENT_SECRET}'.encode("ascii"))
    return {
        'Authorization': f'Basic {encoded_client_secrets.decode("ascii")}',
        'Content-Type': 'application/json'
    }

def get_token() -> dict:
    """Get the access token based on a new authorization code. The authorization code will be
    invalid once it used.
    """
    # full url: https://api.enphaseenergy.com/oauth/token?grant_type=authorization_code&redirect_uri={REDIRECT_URI}&code={CODE}
    params = {
        'grant_type': 'authorization_code',
        'redirect_uri': REDIRECT_URI,
        'code': CODE
    }
    response = requests.post(TOKEN_URL, params=params, headers=generate_basic_headers())
    if response.status_code == 200:
        return response.json()
    else:
        print(f'Get new token failed, with status code {response.status_code}')
        return

print(get_token())
```